<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>字幕XMLジェネレーター</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background: #f4f4f4;
    }
    textarea {
      width: 100%;
      height: 200px;
      margin-bottom: 1rem;
    }
    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <h1>字幕XMLジェネレーター</h1>
  <label for="inputText">字幕テキスト（1行ずつ）:</label><br />
  <textarea id="inputText" placeholder="1行ずつテキストを入力してください"></textarea><br />
  <label for="durationInput">各字幕の長さ（秒）:</label>
  <input type="number" id="durationInput" value="5" min="1" style="width: 60px;" />
  <button onclick="generateXML()">XML生成</button>
  <h2>生成されたXML:</h2>
  <textarea id="outputXML" readonly></textarea>
  <script>
    function escapeXML(str) {
      return str.replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    function generateXML() {
      const lines = document.getElementById('inputText').value
        .split('\n')
        .map(l => l.trim())
        .filter(l => l);
      const fps = 30;
      const durationSec = parseInt(document.getElementById('durationInput').value, 10) || 5;
      const duration = durationSec * fps;

      let output = `<?xml version="1.0" encoding="utf-8"?>\n<xmeml version="5">\n  <sequence id="video">\n    <name>txtconvert</name>\n    <duration>${lines.length * duration}</duration>\n    <rate><timebase>${fps}</timebase><ntsc>false</ntsc></rate>\n    <media>\n      <video>\n        <format>\n          <samplecharacteristics>\n            <width>1920</width><height>1080</height>\n            <anamorphic>false</anamorphic>\n            <pixelaspectratio>square</pixelaspectratio>\n          </samplecharacteristics>\n        </format>\n        <track>`;

      lines.forEach((rawText, i) => {
        let text = rawText.replace(/&/g, '＆').replace(/"/g, '”');
        const safeText = escapeXML(text);
        const start = i * duration;
        const end = start + duration;

        output += `\n          <generatoritem id="Outline Text${i + 1}">\n            <name>${safeText}</name>\n            <duration>${duration}</duration>\n            <rate><timebase>${fps}</timebase><ntsc>false</ntsc></rate>\n            <start>${start}</start>\n            <end>${end}</end>\n            <enabled>true</enabled>\n            <alphatype>black</alphatype>\n            <masterclipid>Outline Text${i + 1}</masterclipid>\n            <effect>\n              <name>Outline Text</name>\n              <effectid>outline text</effectid>\n              <effectcategory>text</effectcategory>\n              <effecttype>generator</effecttype>\n              <mediatype>video</mediatype>\n              <parameter>\n                <name>Text</name>\n                <parameterid>str</parameterid>\n                <value>${safeText}</value>\n              </parameter>\n            </effect>\n          </generatoritem>`;
      });

      output += `\n        </track>\n      </video>\n    </media>\n  </sequence>\n</xmeml>`;
      document.getElementById('outputXML').value = output;
    }
  </script>
</body>
</html>